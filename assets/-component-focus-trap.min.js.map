{
  "version": 3,
  "sources": ["../components/src/focus-trap.js"],
  "sourcesContent": ["import { LitElement, html } from 'lit'\n\nclass HHFocusTrap extends LitElement {\n  static properties = {\n    isActive: {\n      attribute: 'active',\n      converter(value) {\n        if (value === 'false') return false\n        return true\n      },\n    },\n    selector: {\n      type: String,\n    },\n  }\n\n  constructor() {\n    super()\n\n    this.focusIn = this.focusIn.bind(this)\n    this.keyDown = this.keyDown.bind(this)\n  }\n\n  requestUpdate(name, oldValue) {\n    const newValue = this[name]\n    if (name === 'isActive') {\n      if (newValue === true) {\n        this.addTrapFocus(this.renderRoot)\n        this.selectInitialElement()\n      } else {\n        this.removeTrapFocus()\n      }\n    }\n\n    return super.requestUpdate(name, oldValue)\n  }\n\n  selectInitialElement() {\n    for (let i = 0; i < this.elements.length; i++) {\n      if (!this.selector) {\n        this.elements[i].focus()\n        break\n      }\n      if (this.elements[i].matches(this.selector)) {\n        this.elements[i].focus()\n        break\n      }\n    }\n  }\n\n  isHidden(element) {\n    return (\n      element.getAttribute('tabindex') === '-1' ||\n      element.hasAttribute('hidden') ||\n      (element.hasAttribute('aria-hidden') &&\n        element.getAttribute('aria-hidden') !== 'false') ||\n      element.style.display === `none` ||\n      element.style.opacity === `0`\n    )\n  }\n\n  isFocusable(element) {\n    return (\n      element.hasAttribute('tabindex') ||\n      ((element instanceof HTMLAnchorElement ||\n        element instanceof HTMLAreaElement) &&\n        element.hasAttribute('href')) ||\n      element instanceof HTMLButtonElement ||\n      element instanceof HTMLInputElement ||\n      element instanceof HTMLTextAreaElement ||\n      element instanceof HTMLSelectElement ||\n      element instanceof HTMLIFrameElement\n    )\n  }\n\n  traverseSlot(element, depth) {\n    const assignedNodes = element\n      .assignedNodes()\n      .filter((node) => node.nodeType === 1)\n    if (assignedNodes.length > 0) {\n      const parent = assignedNodes[0].parentElement\n      return this.queryShadowRoot(parent, depth + 1)\n    }\n\n    return []\n  }\n\n  queryShadowRoot(root, depth = 1, maxDepth = 20) {\n    if (!root) {\n      return []\n    }\n    const matches = []\n    for (const $child of Array.from(root.children || [])) {\n      if (this.isHidden($child)) {\n        continue\n      }\n\n      if (this.isFocusable($child)) {\n        matches.push($child)\n      }\n\n      if ($child.shadowRoot != null) {\n        matches.push(...this.queryShadowRoot($child.shadowRoot, depth + 1))\n      } else if ($child.tagName === 'SLOT') {\n        matches.push(...this.traverseSlot($child, depth))\n      } else {\n        matches.push(...this.queryShadowRoot($child, depth + 1))\n      }\n    }\n    return matches\n  }\n\n  focusIn(event) {\n    if (\n      event.target !== this.renderRoot &&\n      event.target !== this.last &&\n      event.target !== this.first\n    ) {\n      return\n    }\n\n    event.target.addEventListener('keydown', this.keyDown)\n  }\n\n  keyDown(event) {\n    if (event.code.toUpperCase() !== 'TAB') return\n    if (event.target === this.last && !event.shiftKey) {\n      event.preventDefault()\n      this.first.focus()\n    }\n    if (\n      (event.target === this.renderRoot || event.target === this.first) &&\n      event.shiftKey\n    ) {\n      event.preventDefault()\n      this.last.focus()\n    }\n  }\n\n  removeTrapFocus() {\n    ;(this.elements || []).forEach((element) => {\n      element.removeEventListener('focusin', this.focusIn)\n      element.removeEventListener('keydown', this.keyDown)\n    })\n  }\n\n  addTrapFocus(root) {\n    this.removeTrapFocus()\n\n    this.elements = this.queryShadowRoot(root)\n    this.first = this.elements[0]\n    this.last = this.elements[this.elements.length - 1]\n\n    this.elements.forEach((element) => {\n      element.addEventListener('focusin', this.focusIn)\n    })\n  }\n\n  disconnectedCallback() {\n    super.disconnectedCallback()\n    this.removeTrapFocus()\n  }\n\n  render() {\n    return html`<slot></slot> `\n  }\n}\ncustomElements.define('hh-focus-trap', HHFocusTrap)\n"],
  "mappings": "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",
  "names": []
}
